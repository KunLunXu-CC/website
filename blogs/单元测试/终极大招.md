# 终极大招： karma + mocha + chai

## 初始化项目：

- 初始化项目： npm init -y
- 安装 karma: npm install karma -D
- 初始化 karma 配置： ./node_modules/.bin/karma init  （配置后期都可以改的）

```shell
$ ./node_modules/.bin/karma init
# 选择单元测试框架：这里选择 mocha
Which testing framework do you want to use ?
Press tab to list possible options. Enter to move to the next question.
> mocha

# 是否使用 Require.js 插件
Do you want to use Require.js ?
This will add Require.js plugin.
Press tab to list possible options. Enter to move to the next question.
> no

# 选择浏览器这里选择 PhantomJS （无界面浏览器）
Do you want to capture any browsers automatically ?
Press tab to list possible options. Enter empty string to move to the next question.
> PhantomJS
>

# 设置 files 字段内容（不管后面弄）
What is the location of your source and test files ?
You can use glob patterns, eg. "js/*.js" or "test/**/*Spec.js".
Enter empty string to move to the next question.
>

# 设置 excluded 字段内容（不管后面弄）
Should any of the files included by the previous patterns be excluded ?
You can use glob patterns, eg. "**/*.swp".
Enter empty string to move to the next question.
>

# 是否生成引导文件
Do you wanna generate a bootstrap file for RequireJS?
This will generate test-main.js/coffee that configures RequireJS and starts the tests.
> no

Which files do you want to include with <script> tag ?
This should be a script that bootstraps your test by configuring Require.js and kicking __karma__.start(), probably your test-main.js file.
Enter empty string to move to the next question.
>

# 是否时时监听
Do you want Karma to watch all the files and run the tests on change ?
Press tab to list possible options.
> no

```

- 根据配置安装相应依赖：

```shell
$ npm install mocha karma-mocha PhantomJS karma-phantomjs-launcher karma-requirejs requirejs chai -D
```

## 配置 webpack (mocha不支持 ES6 高级语法)

- 安装依赖： npm install karma-webpack webpack -D
- 需要注意的是记得安装： karma-webpack 插件
- 编写特定 webpack 配置 （至于 webpakc 的配置怎么编写就需要根据实际项目来咯！）

```js
module.exports = {
  module: {
    loaders: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        loader: 'babel-loader',
        query: {
          presets: ['env'],
          // plugins: ['istanbul'] // 解决babel编译导致代码覆盖率不全的问题
        }
      }
    ]
  },
  // devtool: 'inline-source-map'
}
```

- 修改 karma 配置使用 webpack 对文件进行预处理编译：
- 配置配置文件 karma.conf.js (1、引入webpack, 2、注册webpack, 3、对指定文件进行预处理)

```js
// [1] 引入
const webpackConfig = require('./webpack/webpack.test.config.js');
module.exports = function(config) {
  // [2] 注册
  webpack: webpackConfig,
  webpackMiddleware: {
    noInfo: true
  },
  // [3] 对指定文件进行预处理
  preprocessors: {
    'test/*.js': ['webpack']
  },
}
```

## 命令行输出 mocha 格式的信息：

- 安装

## 代码覆盖率

- 安装： npm install karma-coverage -D
- 在 preprocessors（预处理配置） 中对指定文件配置 coverage
- 在 reporters（导出配置） 中添加配置对覆盖率报告的导出
- 代码覆盖率导出配置

```js
    preprocessors: {
      'test/*.js': ['webpack', 'coverage']
    },

    webpack: webpackConfig,
    webpackMiddleware: {
      noInfo: true
    },
    // test results reporter to use
    // possible values: 'dots', 'progress'
    // available reporters: https://npmjs.org/browse/keyword/karma-reporter
    reporters: ['mocha', 'coverage'],

    // 代码覆盖率导出配置
    coverageReporter: {
      // 导出类型
      type: 'html',
      // 导出目录设置
      dir: 'coverage/'
    },
```

## react

- 安装： enzyme 根据官网来进行下载（不同版本react安装方法不同，主要不同在于适配器上）
- 简单使用测试：

```js
// setup file
import { configure } from 'enzyme';
import Adapter from 'enzyme-adapter-react-14';

configure({ adapter: new Adapter() });
// test file
import { shallow, mount, render } from 'enzyme';

const wrapper = shallow(<Foo />);
```